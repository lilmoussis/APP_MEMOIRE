datasource db {
    provider = "postgresql"
}

generator client {
    provider = "prisma-client-js"
}

model User {
    id        String   @id @default(uuid())
    email     String   @unique
    username  String   @unique
    password  String
    firstName String?
    lastName  String?
    phone     String?
    role      Role     @default(GERANT)
    isActive  Boolean  @default(true)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@map("users")
}

enum Role {
    SUPER_ADMIN
    GERANT
}

model Parking {
    id              String   @id @default(uuid())
    name            String
    totalCapacity   Int
    availableSpaces Int
    location        String?
    description     String?
    createdAt       DateTime @default(now())
    updatedAt       DateTime @updatedAt

    tariffs Tariff[]
    entries Entry[]

    @@map("parkings")
}

model Tariff {
    id           String      @id @default(uuid())
    parkingId    String
    vehicleType  VehicleType
    pricePerHour Float
    createdAt    DateTime    @default(now())
    updatedAt    DateTime    @updatedAt

    parking Parking @relation(fields: [parkingId], references: [id], onDelete: Cascade)

    @@unique([parkingId, vehicleType])
    @@map("tariffs")
}

enum VehicleType {
    MOTO
    VOITURE
    CAMION
    AUTRE
}

model Vehicle {
    id          String      @id @default(uuid())
    plateNumber String      @unique
    vehicleType VehicleType
    brand       String?
    model       String?
    color       String?
    createdAt   DateTime    @default(now())
    updatedAt   DateTime    @updatedAt

    cards   Card[]
    entries Entry[]

    @@map("vehicles")
}

model Card {
    id         String   @id @default(uuid())
    cardNumber String   @unique
    vehicleId  String
    isActive   Boolean  @default(true)
    createdAt  DateTime @default(now())
    updatedAt  DateTime @updatedAt

    vehicle Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
    entries Entry[]

    @@map("cards")
}

model Entry {
    id            String      @id @default(uuid())
    parkingId     String
    vehicleId     String
    cardId        String?
    entryTime     DateTime    @default(now())
    exitTime      DateTime?
    duration      Int? // en minutes
    amount        Float?
    status        EntryStatus @default(IN_PROGRESS)
    paymentMethod String?
    createdAt     DateTime    @default(now())
    updatedAt     DateTime    @updatedAt

    parking Parking @relation(fields: [parkingId], references: [id])
    vehicle Vehicle @relation(fields: [vehicleId], references: [id])
    card    Card?   @relation(fields: [cardId], references: [id])

    @@map("entries")
}

enum EntryStatus {
    IN_PROGRESS
    COMPLETED
    CANCELLED
}
